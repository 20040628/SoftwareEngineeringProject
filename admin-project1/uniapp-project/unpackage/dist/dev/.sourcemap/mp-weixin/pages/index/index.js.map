{"version":3,"file":"index.js","sources":["pages/index/index.vue","../../安装/HBuilderX/plugins/uniapp-cli-vite/uniPage:/cGFnZXMvaW5kZXgvaW5kZXgudnVl"],"sourcesContent":["<template>\n  <view class=\"container\">\n    <!-- 顶部搜索栏 -->\n    <view class=\"search-bar\">\n      <input \n        class=\"search-input\"\n        placeholder=\"搜索附近车辆\"\n        v-model=\"searchKeyword\"\n        @confirm=\"handleSearch\"\n      />\n      <button class=\"location-btn\" @click=\"centerToUser\">\n        <image src=\"/static/icons/location.png\" class=\"location-icon\"/>\n      </button>\n    </view>\n\n    <!-- 地图容器 -->\n    <map \n      id=\"map\"\n      :latitude=\"mapCenter.latitude\"\n      :longitude=\"mapCenter.longitude\"\n      :markers=\"scooters\"\n      :show-location=\"true\"\n      style=\"width: 100%; height: 70vh;\"\n      @marker-tap=\"handleMarkerTap\"\n    >\n      <!-- 自定义定位按钮 -->\n      <cover-view class=\"custom-controls\">\n        <cover-image \n          src=\"/static/icons/current_location.png\"\n          @tap=\"centerToUser\"\n          class=\"control-btn\"\n        />\n      </cover-view>\n    </map>\n\n    <!-- 底部车辆列表 -->\n    <scroll-view \n      class=\"scooter-list\"\n      scroll-y\r\n\t  @scroll=\"adjustListHeight\"\n      :style=\"{ height: listHeight + 'px' }\"\n    >\n      <view \n        v-for=\"scooter in scooters\"\n        :key=\"scooter.id\"\n        class=\"scooter-item\"\n        @click=\"showScooterDetail(scooter)\"\n      >\n        <!-- <image :src=\"scooter.image\" class=\"scooter-image\"/> -->\n        <view class=\"scooter-info\">\n          <text class=\"scooter-name\">{{ scooter.id }}</text>\n          <view class=\"details\">\n            <text class=\"distance\">{{ scooter.location }}</text>\n            <view class=\"battery\">\n              <!-- <image src=\"/static/icons/battery.png\" class=\"battery-icon\"/>\n              <text>{{ scooter.battery }}%</text> -->\n            </view>\n          </view>\n        </view>\n      </view>\n    </scroll-view>\n  </view>\n</template>\n<script>\nexport default {\n  data() {\n    return {\n      mapCenter: {\n        latitude: 39.90469,  // 默认北京坐标\n        longitude: 116.40717\n      },\n      userLocation: null,\n      searchKeyword: '',\n      scooters:[],\r\n\t  isLoading:true,\n      listHeight: 300,\r\n\t  maxListHeight: 900, // 列表最大高度（单位 px）\r\n\t  minListHeight: 300\n    }\n  },\n  // computed: {\n  //   filteredScooters() {\n  //     return this.scooters.filter(scooter => \n  //       scooter.name.includes(this.searchKeyword)\n  //     ).map(scooter => ({\n  //       ...scooter,\n  //       iconPath: '/static/marker.png', // 地图标记图标\n  //       width: 30,\n  //       height: 40\n  //     }))\n  //   }\n  // },\n  async mounted() {\n     this.getUserLocation();\r\n     this.calcListHeight();\r\n     await this.loadScooters();\n  },\n  methods: {\r\n\t// 获取车辆列表\r\n\tasync loadScooters() {\r\n\t  try {\r\n\t    // 发起 GET 请求来获取所有滑板车的列表数据\r\n\t    const res = await uni.request({\r\n\t      url: 'http://localhost:8080/api/scooters/getAll',  // 后端接口地址\r\n\t      method: 'GET'  // 请求方法为 GET\r\n\t    });\r\n\t\r\n\t    // 如果响应状态码为 200（请求成功）\r\n\t    if (res.statusCode === 200) {\r\n\t      this.scooters = res.data;  // 将后端返回的滑板车数据赋值给 scooters\r\n\t    } else {\r\n\t      // 如果状态码不是 200，则显示加载失败的提示\r\n\t      uni.showToast({ title: '数据加载失败', icon: 'none' });\r\n\t    }\r\n\t  } catch (err) {\r\n\t    // 捕获并处理网络错误，显示提示\r\n\t    uni.showToast({ title: '网络错误', icon: 'none' });\r\n\t  } finally {\r\n\t    // 请求完成后，无论成功还是失败，都将 isLoading 设置为 false\r\n\t    this.isLoading = false;\r\n\t  }\r\n\t},\r\n\t\r\n\t// 跳转到详情页\r\n\tshowScooterDetail(scooter) {\r\n\t  // 跳转到详情页，传递 scooter.id 作为参数\r\n\t  uni.navigateTo({\r\n\t    url: `/pages/cardetail/cardetail?id=${scooter.id}`\r\n\t  })\r\n\t},\r\n\r\n\t\t\r\n\n    //获取用户位置\n    async getUserLocation() {\n      try {\n        const res = await uni.getLocation({ type: 'gcj02' })\n        this.userLocation = res\n        this.mapCenter = res\n      } catch (err) {\n        console.error('获取定位失败:', err)\n      }\n    },\n\n    // 回到当前位置\n    centerToUser() {\n      if (this.userLocation) {\n        this.mapCenter = this.userLocation\n      }\n    },\r\n\tadjustListHeight(event) {\r\n\t    const scrollTop = event.detail.scrollTop;\r\n        const newHeight = Math.min(this.maxListHeight, Math.max(this.minListHeight, this.minListHeight + scrollTop / 3));\r\n\t    this.listHeight = newHeight;\r\n\t},\n\t// 计算列表高度\n\tcalcListHeight() {\n\t\t  uni.getSystemInfo({\n\t\t\tsuccess: (res) => {\n\t\t\t  this.listHeight = res.windowHeight * 0.3\n\t\t\t}\n\t\t  })\n\t\t},\n\n\n\t\t// 地图标记点击\n\thandleMarkerTap(e) {\n\t\t  const scooterId = e.markerId\n\t\t  const scooter = this.scooters.find(s => s.id === scooterId)\n\t\t  this.showScooterDetail(scooter)\n\t\t}\n\n\t// \t// 搜索处理\n\t// handleSearch() {\n\t// \t  // 实际开发中可调用后端搜索接口\n\t// \t  console.log('搜索关键词:', this.searchKeyword)\n\t// \t}\n\t}\n}\n</script>\n\n<style scoped>\n.container {\n  position: relative;\n  height: 100vh;\n}\n\n.search-bar {\n  position: absolute;\n  top: 20rpx;\n  left: 20rpx;\n  right: 20rpx;\n  z-index: 999;\n  display: flex;\n  gap: 15rpx;\n  background: rgba(255, 255, 255, 0.9);\n  border-radius: 50rpx;\n  padding: 20rpx;\n  box-shadow: 0 4rpx 12rpx rgba(0, 0, 0, 0.1);\n}\n\n.search-input {\n  flex: 1;\n  height: 60rpx;\n  padding-left: 30rpx;\n}\n\n.location-btn {\n  width: 80rpx;\n  height: 80rpx;\n  border-radius: 50%;\n  background: #fff;\n  padding: 0;\n}\n\n.location-icon {\n  width: 50rpx;\n  height: 50rpx;\n}\n\n.custom-controls {\n  position: absolute;\n  right: 30rpx;\n  bottom: 200rpx;\n}\n\n.control-btn {\n  width: 80rpx;\n  height: 80rpx;\n  border-radius: 50%;\n  box-shadow: 0 4rpx 12rpx rgba(0, 0, 0, 0.2);\n}\n\n.scooter-list {\n  position: absolute;\n  bottom: 0;\n  left: 0;\n  right: 0;\n  background: #fff;\n  border-radius: 40rpx 40rpx 0 0;\n  padding: 30rpx;\n  box-shadow: 0 -4rpx 12rpx rgba(0, 0, 0, 0.1);\r\n  z-index: 999;\n}\n\n.scooter-item {\n  display: flex;\n  align-items: center;\n  padding: 30rpx;\n  background: #f8f8f8;\n  border-radius: 20rpx;\n  margin-bottom: 20rpx;\n}\n\n.scooter-image {\n  width: 200rpx;\n  height: 160rpx;\n  margin-right: 30rpx;\n}\n\n.scooter-info {\n  flex: 1;\n}\n\n.scooter-name {\n  font-size: 34rpx;\n  font-weight: bold;\n  color: #333;\n}\n\n.details {\n  display: flex;\n  justify-content: space-between;\n  margin-top: 15rpx;\n}\n\n.distance {\n  color: #666;\n  font-size: 28rpx;\n}\n\n.battery {\n  display: flex;\n  align-items: center;\n  color: #4CAF50;\n}\n\n.battery-icon {\n  width: 30rpx;\n  height: 30rpx;\n  margin-right: 10rpx;\n}\n</style>","import MiniProgramPage from 'D:/uniapp-project/project/pages/index/index.vue'\nwx.createPage(MiniProgramPage)"],"names":["uni"],"mappings":";;;AAgEA,MAAK,YAAU;AAAA,EACb,OAAO;AACL,WAAO;AAAA,MACL,WAAW;AAAA,QACT,UAAU;AAAA;AAAA,QACV,WAAW;AAAA,MACZ;AAAA,MACD,cAAc;AAAA,MACd,eAAe;AAAA,MACf,UAAS,CAAE;AAAA,MACd,WAAU;AAAA,MACP,YAAY;AAAA,MACf,eAAe;AAAA;AAAA,MACf,eAAe;AAAA,IACd;AAAA,EACD;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAaD,MAAM,UAAU;AACb,SAAK,gBAAe;AACpB,SAAK,eAAc;AACnB,UAAM,KAAK;EACb;AAAA,EACD,SAAS;AAAA;AAAA,IAEV,MAAM,eAAe;AACnB,UAAI;AAEF,cAAM,MAAM,MAAMA,cAAG,MAAC,QAAQ;AAAA,UAC5B,KAAK;AAAA;AAAA,UACL,QAAQ;AAAA;AAAA,QACV,CAAC;AAGD,YAAI,IAAI,eAAe,KAAK;AAC1B,eAAK,WAAW,IAAI;AAAA,eACf;AAELA,wBAAG,MAAC,UAAU,EAAE,OAAO,UAAU,MAAM,OAAK,CAAG;AAAA,QACjD;AAAA,MACA,SAAO,KAAK;AAEZA,sBAAG,MAAC,UAAU,EAAE,OAAO,QAAQ,MAAM,OAAK,CAAG;AAAA,MAC/C,UAAU;AAER,aAAK,YAAY;AAAA,MACnB;AAAA,IACD;AAAA;AAAA,IAGD,kBAAkB,SAAS;AAEzBA,oBAAAA,MAAI,WAAW;AAAA,QACb,KAAK,iCAAiC,QAAQ,EAAE;AAAA,OACjD;AAAA,IACF;AAAA;AAAA,IAKE,MAAM,kBAAkB;AACtB,UAAI;AACF,cAAM,MAAM,MAAMA,cAAG,MAAC,YAAY,EAAE,MAAM,SAAS;AACnD,aAAK,eAAe;AACpB,aAAK,YAAY;AAAA,MACjB,SAAO,KAAK;AACZA,sBAAAA,MAAc,MAAA,SAAA,gCAAA,WAAW,GAAG;AAAA,MAC9B;AAAA,IACD;AAAA;AAAA,IAGD,eAAe;AACb,UAAI,KAAK,cAAc;AACrB,aAAK,YAAY,KAAK;AAAA,MACxB;AAAA,IACD;AAAA,IACJ,iBAAiB,OAAO;AACpB,YAAM,YAAY,MAAM,OAAO;AAC5B,YAAM,YAAY,KAAK,IAAI,KAAK,eAAe,KAAK,IAAI,KAAK,eAAe,KAAK,gBAAgB,YAAY,CAAC,CAAC;AAClH,WAAK,aAAa;AAAA,IACrB;AAAA;AAAA,IAED,iBAAiB;AACdA,oBAAAA,MAAI,cAAc;AAAA,QACnB,SAAS,CAAC,QAAQ;AAChB,eAAK,aAAa,IAAI,eAAe;AAAA,QACvC;AAAA,OACE;AAAA,IACF;AAAA;AAAA,IAIF,gBAAgB,GAAG;AAChB,YAAM,YAAY,EAAE;AACpB,YAAM,UAAU,KAAK,SAAS,KAAK,OAAK,EAAE,OAAO,SAAS;AAC1D,WAAK,kBAAkB,OAAO;AAAA,IAChC;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAOD;AACD;;;;;;;;;;;;;;;;;;;;;;;;;;;ACjLA,GAAG,WAAW,eAAe;"}